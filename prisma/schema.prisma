// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL_NON_POOLING")
}

model Company {
  id          String   @id @default(cuid())
  companyId   String   @unique // "company id" from requirements, maybe an external ID
  name        String
  authId      String   // "auth id" from requirements
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  users       User[]
  trips       Trip[]
}

model User {
  id          String   @id @default(cuid())
  userId      String   @unique // "user id" from requirements, separate from internal PK
  name        String
  email       String   @unique
  phoneNumber String?
  addedBy     String?  // "the one who added them"
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company     Company  @relation(fields: [companyId], references: [id])
  trips       TripParticipant[]
}

model Trip {
  id            String   @id @default(cuid())
  // tripId        String   @unique // Removed manual ID to simplify
  startDate     DateTime
  endDate       DateTime
  startingPoint String
  destination   String
  budget        Float
  companyId     String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  company       Company  @relation(fields: [companyId], references: [id])
  participants  TripParticipant[]
}

model TripParticipant {
  id        String @id @default(cuid())
  tripId    String
  userId    String
  token     String @unique @default(cuid())
  
  trip      Trip   @relation(fields: [tripId], references: [id])
  user      User   @relation(fields: [userId], references: [id])
  
  @@unique([tripId, userId])
}
